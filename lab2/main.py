#!/usr/bin/env python3
"""
–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∂–∏–≤–æ—Ç–Ω—ã—Ö

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã. –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from lab2.processor.image_processor import CatImageProcessor


def display_welcome() -> None:
    print("=" * 60)
    print("–õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø –†–ê–ë–û–¢–ê ‚Ññ2: –û–ë–†–ê–ë–û–¢–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ñ–ò–í–û–¢–ù–´–•")
    print("=" * 60)
    print()
    print("–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:")
    print("‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∂–∏–≤–æ—Ç–Ω—ã—Ö —Å The Cat API")
    print("‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä–æ–¥—ã –∂–∏–≤–æ—Ç–Ω–æ–≥–æ")
    print("‚Ä¢ –í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏")
    print("‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é")
    print("‚Ä¢ –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π")
    print()


def get_user_input() -> int:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Returns:
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

    Raises:
        SystemExit: –ü—Ä–∏ –≤–≤–æ–¥–µ 'q' –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    """
    print("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (1-10)")
    print("–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ 'q' –¥–ª—è –≤—ã—Ö–æ–¥–∞")

    while True:
        try:
            user_input = input(">>> ").strip().lower()

            if user_input == 'q':
                print("–í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã...")
                sys.exit(0)

            limit = int(user_input)

            if limit < 1:
                print("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
                continue
            elif limit > 10:
                print("–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞")
                confirm = input("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): ").strip().lower()
                if confirm != 'y':
                    continue

            return limit

        except ValueError:
            print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–ª–∏ 'q' –¥–ª—è –≤—ã—Ö–æ–¥–∞")
        except KeyboardInterrupt:
            print("\n–í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã...")
            sys.exit(0)


def display_stats(processor: CatImageProcessor) -> None:
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º."""
    stats = processor.get_stats()

    print("\n" + "=" * 40)
    print("–°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò")
    print("=" * 40)
    print(f"–í—Å–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {stats['total_images']}")
    print(f"–¶–≤–µ—Ç–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {stats['color_images']}")
    print(f"–ß/–ë –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {stats['grayscale_images']}")
    print(f"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Ä–æ–¥: {len(stats['breeds'])}")

    if stats['breeds']:
        print("–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–¥:")
        for breed in stats['breeds']:
            print(f"   ‚Ä¢ {breed}")

    print("=" * 40)


def main() -> None:
    display_welcome()

    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
    processor = CatImageProcessor()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ API –∫–ª—é—á–∞
    if not processor.api_key:
        print("–û—à–∏–±–∫–∞: API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ñ–∞–π–ª–µ .env")
        print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
        print("1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://thecatapi.com/")
        print("2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á")
        print("3. –î–æ–±–∞–≤—å—Ç–µ API_KEY=–≤–∞—à_–∫–ª—é—á –≤ —Ñ–∞–π–ª .env")
        return

    try:
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        limit = get_user_input()

        print(f"\n–ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É {limit} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...")

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        processor.download_images(limit)

        if not processor.downloaded_images:
            print("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.")
            print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:")
            print("‚Ä¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É")
            print("‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å API_KEY")
            print("‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å The Cat API")
            return

        #if len(processor.downloaded_images) >= 2:
         #   try:
                # Add operation
          #      result_add = processor.downloaded_images[0].__add__(processor.downloaded_images[1])
           #     print(f"\n–°–ª–æ–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: {result_add.breed}")
            #    processor.downloaded_images.append(result_add)
             #   print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–æ–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ 'result_add.jpg'")

                # Sub operation
                #result_sub = processor.downloaded_images[0].__sub__(processor.downloaded_images[1])
                #print(f"–í—ã—á–∏—Ç–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: {result_sub.breed}")

                # Del operation
                #print(f"–î–æ —É–¥–∞–ª–µ–Ω–∏—è: {len(processor.downloaded_images)} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
                #del processor.downloaded_images[0]
                #print(f"–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è: {len(processor.downloaded_images)} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")

            #except ValueError as e:
             #   print(f"–û—à–∏–±–∫–∞ –≤ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö: {e}")


        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        processor.save_images("processed_images")
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        display_stats(processor)

        print("\n–û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!")
        print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: processed_images/")

    except KeyboardInterrupt:
        print("\n\nÔ∏è–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"\n–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞")
    finally:
        print("\n–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã! üêæ")


if __name__ == "__main__":
    main()